<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>this_fiber - IOFiber</title>
  <meta property="og:title" content="this_fiber" />
  <meta name="twitter:title" content="this_fiber" />
  <meta name="description" content="class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as you wish, but you should only use its methods within the fiber context (i.e. within the fiber execution stack) that created it.
   Important  fiber is a typedef for basic_fiber&lt;boost::asio::io_context::strand&gt;.">
  <meta property="og:description" content="class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as you wish, but you should only use its methods within the fiber context (i.e. within the fiber execution stack) that created it.
   Important  fiber is a typedef for basic_fiber&lt;boost::asio::io_context::strand&gt;.">
  <meta name="twitter:description" content="class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as …"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "IOFiber",
    
    "url": "http://vinipsmaker.github.io/iofiber/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http://vinipsmaker.github.io/iofiber/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http://vinipsmaker.github.io/iofiber/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http://vinipsmaker.github.io/iofiber/ref/this_fiber/",
          "name": "This fiber"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "this_fiber",
  "description" : "class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as you wish, but you should only use its methods within the fiber context (i.e. within the fiber execution stack) that created it.
   Important  fiber is a typedef for basic_fiber&amp;lt;boost::asio::io_context::strand&amp;gt;.",
  "inLanguage" : "en",
  "wordCount": 569,
  "datePublished" : "0001-01-01T00:00:00",
  "dateModified" : "0001-01-01T00:00:00",
  "image" : "http://vinipsmaker.github.io/iofiber/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "http://vinipsmaker.github.io/iofiber/ref/this_fiber/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http://vinipsmaker.github.io/iofiber/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http://vinipsmaker.github.io/iofiber/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="this_fiber" />
<meta property="og:description" content="class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as you wish, but you should only use its methods within the fiber context (i.e. within the fiber execution stack) that created it.
   Important  fiber is a typedef for basic_fiber&lt;boost::asio::io_context::strand&gt;.">
<meta property="og:url" content="http://vinipsmaker.github.io/iofiber/ref/this_fiber/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="IOFiber" />
  <meta name="twitter:title" content="this_fiber" />
  <meta name="twitter:description" content="class fiber::this_fiber;   To have access to a this_fiber object, just spawn() a fiber and an object of this type will be created for you. You can copy and pass it around freely to other functions as …">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://vinipsmaker.github.io/iofiber/ref/this_fiber/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="IOFiber" />

  <meta name="generator" content="Hugo 0.52" />
  <link rel="alternate" href="http://vinipsmaker.github.io/iofiber/index.xml" type="application/rss+xml" title="IOFiber">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://vinipsmaker.github.io/iofiber/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://vinipsmaker.github.io/iofiber/css/highlight.min.css" /><link rel="stylesheet" href="http://vinipsmaker.github.io/iofiber/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://vinipsmaker.github.io/iofiber/">IOFiber</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Tutorials(7)" href="/iofiber/tutorial/">Tutorials(7)</a>
            </li>
          
        
          
            <li>
              <a title="Reference(3)" href="/iofiber/ref/">Reference(3)</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="ref-heading">
              
                <h1>this_fiber</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">class fiber::this_fiber;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have access to a <code>this_fiber</code> object, just <code>spawn()</code> a fiber and an object of
this type will be created for you. You can copy and pass it around freely to
other functions as you wish, but you should only use its methods within the
fiber context (i.e. within the fiber execution stack) that created it.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>fiber</code> is a typedef for
<code>basic_fiber&lt;boost::asio::io_context::strand&gt;</code>. <code>Strand</code> below will refer to the
template argument of the instantiation used.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_member_functions">Member-functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_operator"><code>operator[]()</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">this_fiber operator[](boost::system::error_code&amp; ec) const;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will return a new <code>this_fiber</code> object which will fill <code>ec</code> instead throwing an
exception when used as a completion token argument for <code>async_*</code> functions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void start(fiber::this_fiber this_fiber)
{
  boost::asio::steady_timer timer{this_fiber.get_executor().context()};
  timer.expires_from_now(std::chrono::seconds(1));

  boost::system::error_code ec;
  timer.async_wait(this_fiber[ec]);
  if (ec) {
    // ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operator_call"><code>operator()()</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">template&lt;class T, class... Args&gt;
void operator()(T&amp; o,
                void(T::*async_fn)(
                    Args..., const basic_this_fiber&lt;Strand&gt;&amp;),
                Args&amp;&amp;... args);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the fiber <a href="#interrupter"><code>interrupter</code></a> variable to <code>o.cancel()</code> and calls
<code>(o.*async_fn)(std::forward&lt;Args&gt;(args)&#8230;&#8203;, *this)</code>.</p>
</div>
<div class="paragraph">
<p><code>boost::asio::error::operation_aborted</code> errors will be translated to
<code>fiber_interrupted</code> exceptions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void start(fiber::this_fiber this_fiber)
{
  boost::asio::steady_timer timer{this_fiber.get_executor().context()};
  timer.expires_from_now(std::chrono::seconds(1));

  this_fiber(timer, &amp;boost::asio::steady_timer::async_wait);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_executor"><code>get_executor()</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">Strand get_executor() const;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returns the strand associated with this fiber. You can set the strand associated
with the fiber by passing the desired strand by the time you call
<code>spawn()</code>. User-code running on this fiber will always be executed through this
strand. Implementation details might or might not move the fiber through
different strands to perform some synchronization but no user code will be
called while the fiber is in a foreign strand.</p>
</div>
</div>
<div class="sect2">
<h3 id="_yield"><code>yield()</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void yield();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Re-schedules the fiber to be executed soon. Use this function to yields CPU-time
to other fibers if you don&#8217;t want to block the thread while doing intensive CPU
work for a long period of time.</p>
</div>
</div>
<div class="sect2">
<h3 id="call"><code>call()</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">template&lt;class R, class T, class... Args&gt;
R call(T&amp; o, R(T::*async_fn)(Args..., const basic_this_fiber&lt;Strand&gt;&amp;),
       Args&amp;&amp;... args);

template&lt;class T, class... Args&gt;
void call(T&amp; o,
          void(T::*async_fn)(Args..., const basic_this_fiber&lt;Strand&gt;&amp;),
          Args&amp;&amp;... args);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sets the fiber <a href="#interrupter"><code>interrupter</code></a> variable to <code>o.cancel()</code> and calls
<code>(o.*async_fn)(std::forward&lt;Args&gt;(args)&#8230;&#8203;, *this)</code>. If <code>R</code> is provided,
function will return value from <code>async_fn()</code> call.</p>
</div>
<div class="paragraph">
<p><code>boost::asio::error::operation_aborted</code> errors will be translated to
<code>fiber_interrupted</code> exceptions.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void start(fiber::this_fiber this_fiber)
{
  boost::asio::steady_timer timer{this_fiber.get_executor().context()};
  timer.expires_from_now(std::chrono::seconds(1));

  this_fiber.call&lt;&gt;(timer, &amp;boost::asio::steady_timer::async_wait);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_member_variables">Member variables</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="interrupter"><code>interrupter</code></h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">std::function&lt;void()&gt;&amp; interrupter;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you interrupt a fiber (i.e. <code>fiber::interrupt()</code>), a generic interruption
trigger will be executed to wake-up the fiber and throw a <code>fiber_interrupted</code>
exception. However, this behaviour won&#8217;t immediately cancel pending IO
requests. Suppose your fiber is suspended in the following point when an
interruption request arrives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">void start(fiber::this_fiber this_fiber)
{
  boost::asio::steady_timer timer{this_fiber.get_executor().context()};
  timer.expires_from_now(std::chrono::seconds(1));

  try {
    timer.async_wait(this_fiber);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might postpone interruption fulfilment to later by having some code like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">  } catch (const fiber_interruption&amp;) {
    [[maybe_unused]]
    fiber::this_fiber::disable_interruption di{this_fiber};

    // some time (time != CPU time) consuming task here</code></pre>
</div>
</div>
<div class="paragraph">
<p>By this point, the <code>timer</code> object is still alive and its pending request hasn&#8217;t
been cancelled yet — it&#8217;d be automatically cancelled by letting the destructor
run.</p>
</div>
<div class="paragraph">
<p>You can fix this situation by having a custom interrupter to wake-up the fiber
when an interruption request arrives. Just assign a value to this variable right
before reaching a fiber suspension point.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It&#8217;s only useful to modify this variable for IO requests (i.e. <code>async_*</code>
functions) as the default interrupter will do fine for <code>this_fiber.yield()</code>,
<code>fib.join(this_fiber)</code> and other synchronization techniques shown here.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">See also</div>
<ul>
<li>
<p><a href="#operator_call"><code>operator()</code></a>.</p>
</li>
<li>
<p><a href="#call"><code>call()</code></a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nested_types">Nested types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_disable_interruption"><code>disable_interruption</code></h3>
<div class="paragraph">
<p>Saves current interruption enabled state (and disable interruptions) on
construction and restores it on destruction. It&#8217;s non-moveable and non-copyable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restore_interruption"><code>restore_interruption</code></h3>
<div class="paragraph">
<p>TODO: check Boost.Thread&#8217;s <code>restore_interruption</code> while I write documentation to
this class. It&#8217;s the same idea.</p>
</div>
</div>
</div>
</div>


        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
          
        </ul>
      


      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            0001
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://vinipsmaker.github.io/iofiber/">IOFiber</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.52</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://vinipsmaker.github.io/iofiber/js/main.js"></script>
<script src="http://vinipsmaker.github.io/iofiber/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="http://vinipsmaker.github.io/iofiber/js/load-photoswipe.js"></script>








  </body>
</html>

